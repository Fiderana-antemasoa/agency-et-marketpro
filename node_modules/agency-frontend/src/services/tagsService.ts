/**
 * Service pour la gestion des tags dans agency-connect
 */

/**
 * Invalide le cache des tags (à appeler après ajout/modification d'une offre)
 * Cette fonction sera utilisée pour synchroniser avec marketplace
 */
export const invalidateTagsCache = (): void => {
  // Cette fonction peut être étendue pour notifier marketplace
  // ou déclencher une synchronisation
  console.log('Cache des tags invalidé - synchronisation avec marketplace');
};

/**
 * Récupère tous les tags uniques depuis les offres locales
 */
export const getAllTagsFromOffers = (offers: any[]): string[] => {
  const allTags = new Set<string>();
  
  offers.forEach((offer) => {
    if (offer.tags && Array.isArray(offer.tags)) {
      offer.tags.forEach((tag: string) => {
        if (tag && tag.trim()) {
          allTags.add(tag.trim().toLowerCase());
        }
      });
    }
  });
  
  return Array.from(allTags).sort();
};

/**
 * Récupère les tags les plus populaires depuis les offres
 */
export const getPopularTagsFromOffers = (offers: any[], limit: number = 10): string[] => {
  const tagCounts = new Map<string, number>();
  
  offers.forEach((offer) => {
    if (offer.tags && Array.isArray(offer.tags)) {
      offer.tags.forEach((tag: string) => {
        if (tag && tag.trim()) {
          const normalizedTag = tag.trim().toLowerCase();
          tagCounts.set(normalizedTag, (tagCounts.get(normalizedTag) || 0) + 1);
        }
      });
    }
  });
  
  return Array.from(tagCounts.entries())
    .sort((a, b) => b[1] - a[1])
    .slice(0, limit)
    .map(([tag]) => tag);
};
